CREATE OR REPLACE VIEW dv_current_year_sales_by_customer FOLDER = '/03 - derived views' AS SELECT bv_ldw_customer_mysql.c_customer_sk AS c_customer_sk, bv_ldw_customer_mysql.c_first_name AS c_first_name, bv_ldw_customer_mysql.c_last_name AS c_last_name, bv_ldw_customer_mysql.c_preferred_cust_flag AS c_preferred_cust_flag, bv_ldw_customer_mysql.c_birth_country AS c_birth_country, bv_ldw_customer_mysql.c_login AS c_login, bv_ldw_customer_mysql.c_email_address AS c_email_address, sum(dv_store_sales_all.ss_ext_sales_price) AS year_total, 'S' AS sale_type FROM "Bv_ldw_customer_mysql1" AS bv_ldw_customer_mysql INNER JOIN dv_store_sales_all AS dv_store_sales_all ON bv_ldw_customer_mysql.c_customer_sk = dv_store_sales_all.ss_customer_sk  WHERE dv_store_sales_all.d_year = getyear(now()) GROUP BY bv_ldw_customer_mysql.c_customer_sk, bv_ldw_customer_mysql.c_first_name, bv_ldw_customer_mysql.c_last_name, bv_ldw_customer_mysql.c_preferred_cust_flag, bv_ldw_customer_mysql.c_birth_country, bv_ldw_customer_mysql.c_login, bv_ldw_customer_mysql.c_email_address CONTEXT ('I18N' = 'us_pst');

ALTER VIEW dv_current_year_sales_by_customer
 LAYOUT ("Bv_ldw_customer_mysql1" = [20, 20, 200, 225], dv_store_sales_all = [523, 86, 200, 225]);

